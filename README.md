# 禾启吊舱控制器 (HeQi Gimbal Controller)

基于禾启K40T-MINI四光云台协议开发的Android控制应用程序。

## 功能特性

### 视频显示
- 全屏横屏RTSP视频流播放
- 基于IJKPlayer实现低延迟播放 (<200ms)
- 自动重连机制
- 支持TCP/UDP传输模式

### 云台控制
- 俯仰控制（上/下）
- 偏航控制（左/右）
- 一键回中
- 一键下视90°
- 云台稳像设置
- 波轮速度设置

### 相机控制
- 拍照（单拍/连拍/延时拍）
- 录像（开始/停止）
- 混合变倍（连续/指定倍率）
- 图像模式切换（可见光/红外/分屏）

### 红外相机设置
- 伪彩色设置（20种模式）
- 测温开关
- 点测温/区域测温
- 电子放大
- 超分功能

### 激光测距
- 单次测距
- 周期测距（1秒间隔）

### 状态显示
- 连接状态
- 云台状态（连接状态、自检结果）
- 相机状态（模式、SD卡信息）
- 变倍倍率
- 录像时间

## 技术栈

- **开发语言**: Kotlin
- **UI框架**: XML布局 + Jetpack Compose混合
- **视频播放**: IJKPlayer (基于FFmpeg)
- **网络通信**: UDP Socket
- **架构**: 单例模式管理器

## 协议支持

- 协议版本: V1.4.13
- 通信方式: UDP
- 默认控制IP: 192.168.144.64
- 默认控制端口: 5000
- 默认RTSP地址: rtsp://192.168.144.64:558/live/single

## 项目结构

```
app/src/main/java/com/heqi/gimbal/
├── GimbalApplication.kt          # 应用程序入口
├── model/
│   └── AppSettings.kt            # 应用设置数据类
├── protocol/
│   ├── HeQiProtocol.kt           # 禾启协议实现
│   └── ProtocolManager.kt        # 协议通信管理器
├── video/
│   └── VideoPlayerManager.kt     # 视频播放管理器
└── ui/
    ├── MainActivity.kt           # 主界面
    └── SettingsActivity.kt       # 设置界面

app/src/main/res/
├── layout/
│   ├── activity_main.xml         # 主界面布局
│   └── activity_settings.xml     # 设置界面布局
├── drawable/
│   └── ...                       # 图标和背景资源
└── values/
    ├── strings.xml               # 字符串资源
    ├── colors.xml                # 颜色资源
    └── themes.xml                # 主题资源
```

## 构建说明

### 环境要求
- Android Studio Arctic Fox 或更高版本
- JDK 11 或更高版本
- Android SDK 34
- Gradle 8.0

### 构建步骤

1. 克隆或下载项目代码
2. 使用Android Studio打开项目
3. 同步Gradle依赖
4. 构建APK或直接在设备上运行

```bash
# 命令行构建
./gradlew assembleDebug
```

## 使用说明

### 首次使用
1. 确保手机/平板与吊舱处于同一局域网
2. 打开应用，点击"设置"配置IP地址
3. 点击"连接"按钮建立连接
4. 等待视频画面显示

### 云台控制
- 使用左侧方向按钮控制云台俯仰和偏航
- 按住按钮持续控制，松开自动停止
- 点击"回中"按钮使云台回到初始位置
- 点击"下视90°"按钮使云台垂直向下

### 相机控制
- 点击拍照按钮进行拍照
- 点击录像按钮开始/停止录像
- 使用+/-按钮进行变倍控制
- 点击"可见光"按钮切换图像模式

### 激光测距
- 点击"激光"按钮开启/关闭激光测距
- 测距结果将以Toast形式显示

## 配置说明

### 网络设置
- **相机IP地址**: 吊舱的IP地址（默认192.168.144.64）
- **控制IP地址**: 控制指令发送目标IP（默认192.168.144.64）
- **控制端口**: UDP控制端口（默认5000）
- **RTSP地址**: 视频流地址

### 视频设置
- **缓冲区时间**: 视频缓冲时间（默认100ms）
- **自动重连**: 连接断开后自动重连
- **重连延迟**: 重连等待时间（默认3000ms）

### 云台设置
- **俯仰速度**: 俯仰控制速度（5-150，默认50）
- **偏航速度**: 偏航控制速度（5-150，默认50）

## 注意事项

1. 确保设备与吊舱处于同一网络环境
2. 首次连接可能需要等待几秒钟
3. 视频播放需要足够的网络带宽
4. 控制指令发送频率为10Hz（100ms间隔）
5. 建议在Android 8.0及以上系统使用

## 协议文档

详细的协议说明请参考: `K40T-MINI四光云台对外协议-V1.4.13.docx`

## 许可证

MIT License

## 更新日志

### v1.0.0 (2026-02-03)
- 初始版本发布
- 支持禾启K40T-MINI四光云台协议V1.4.13
- 实现基本云台控制功能
- 实现相机拍照录像功能
- 实现红外相机设置功能
- 实现激光测距功能
